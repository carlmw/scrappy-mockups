<!doctype html>
<html>
<head>
<link rel="stylesheet" href="qunit/qunit/qunit.css" />
<script src="qunit/qunit/qunit.js"></script>
<script src="../scrappy.js"></script>
</head>
<body>
	<h1 id="qunit-header">Scrappy UI</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<script>
	(function(){	
	HTMLElement.prototype.simulate = function(type) {
		var evt = this.ownerDocument.createEvent('MouseEvents');
		evt.initMouseEvent(type, true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
		this.dispatchEvent(evt);
	};

	module('Constructor', {teardown: function(){ Slide.resetAll(); }});

	test('Returns instance', function(){
		var slide = new Slide('test.png');

		ok(slide instanceof Slide, 'should return an instance of Slide');
	});

	test('Loading first image', function(){
		new Slide('test.png');
		var img = document.getElementsByTagName('img')[0];

		equals(img.getAttribute('src'), 'test.png', 'should update the src of the image');
	});

	module('.click', {teardown: function(){ Slide.resetAll(); }});

	test('Returns instance', function(){
		var slide = new Slide('test.png');

		ok((slide instanceof Slide), 'should return an instance of Slide');
	});

	test('Click triggered', function(){
		new Slide('test.png')
			.click()
				.open('test2.png');

		var img = document.getElementsByTagName('img')[0];
		img.simulate('click');
		equals(img.getAttribute('src'), 'test2.png', 'should update the src of the image');
	});

	module('.pause', {teardown: function(){ Slide.resetAll(); }});

	test('Returns instance', function(){
		var slide = new Slide('test.png');

		ok((slide instanceof Slide), 'should return an instance of Slide');
	});

	test('Default pause', function(){
		var start = new Date().valueOf();

		new Slide('test.png')
			.pause();

		var end = new Date().valueOf();

		ok((end - start >= 500), 'should take no less that 500ms to complete: '+(end-start)+'ms');
	});

	test('Custom pause', function(){
		var start = new Date().valueOf();

		new Slide('test.png')
			.pause(1);

		var end = new Date().valueOf();

		ok((end - start >= 1000), 'should take no less than than 1000ms to complete: '+(end-start)+'ms');
	});

	module('.open', {teardown: function(){ Slide.resetAll(); }});

	test('Returns instance', function(){
		var slide = new Slide('test.png');

		ok((slide instanceof Slide), 'should return an instance of Slide');
	});

	test('Opening image', function(){
		new Slide('test.png')
			.open('test2.png');

		var img = document.getElementsByTagName('img')[0];
		equals(img.getAttribute('src'), 'test2.png', 'should update the src of the image');
	});

	test('Image not opened until requested', function(){
		new Slide('test.png')
			.click()
				.open('test2.png');

		var img = document.getElementsByTagName('img')[0];

		ok((img.getAttribute('src') != 'test2.png'), 'src should not be test2.png');
	});

	test('Multiple Slides chain', function(){
		new Slide('test.png')
			.click()
				.open('test2.png');
		
		new Slide('test2.png')
			.click()
				.open('test3.png');
		
		var img = document.getElementsByTagName('img')[0];
		img.simulate('click');
		img.simulate('click');
		equals(img.getAttribute('src'), 'test3.png', 'src should be test3.png');
	});

	})();
	</script>
</body>
</html>